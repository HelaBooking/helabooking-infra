# Cloud Ansible Configuration

## Overview
This directory contains Ansible playbooks and configuration to provision and manage the Kubernetes cluster on AWS.

## Prerequisites
1. **Terraform**: The infrastructure must be provisioned using Terraform in the `../` directory.
   - Terraform generates the `inventory.ini` file automatically upon successful application.
2. **SSH Key**: The private key `generated_key.pem` must exist in the `cloud/` directory (created by Terraform).

## Inventory
The inventory is automatically generated by Terraform at `cloud/ansible/inventory.ini` using the `inventory.tpl` template. It contains:
- `[master]`: The K3s master node.
- `[worker]`: The K3s worker nodes.

## Playbooks

### 1. System Hardening (`playbooks/harden.yml`)
Configures basic server security.
- Updates system packages.
- Installs `fail2ban` and `ufw`.
- Configures firewall rules (Allow SSH, HTTP, HTTPS, K6443, Internal VPC traffic).
- Disables password authentication.

**Usage:**
```bash
ansible-playbook playbooks/harden.yml
```

### 2. Cluster Setup (`playbooks/setup_cluster.yml`)
Deploys Kubernetes components on the K3s cluster.
- Installs **Helm**.
- Installs **Cilium** CNI (replacing/overriding Flannel).
- Installs **ArgoCD** for GitOps.
- Applies the initial ArgoCD Application manifest.

**Usage:**
```bash
ansible-playbook playbooks/setup_cluster.yml
```

## Directory Structure
- `ansible.cfg`: Ansible configuration file.
- `inventory.ini`: Generated inventory file (do not edit manually).
- `k8s/`: Kubernetes manifests (ArgoCD, Apps).
- `playbooks/`: Ansible playbooks (`harden.yml`, `setup_cluster.yml`).
