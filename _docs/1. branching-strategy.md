# Branching Strategy - Helabooking Infra Repository

## Overview

This document outlines the branching strategy adopted for the Helabooking Infrastructure repository. The strategy is design to deploy IaC changes efficiently in each environment while ensuring stability and reliability.

## Branch Structure

- **Main Branch**: The `main` branch serves as the production-ready branch.
- **Environment Branches**: Separate branches are maintained for each environment:
  - `on-prem-management`: On-Premises Cluster Management
  - `dev`: Development environment
  - `qa`: Staging environment
  - `cloud-management`: Cloud Cluster Management
  - `stage`: Pre-production environment
  - `main`: Production environment
- **Change Branches**: Feature or change branches are created from the respective environment branches for implementing changes in to respective environments.
  - Naming Convention: `env/change-description` (e.g., `dev/add-new-service`, `qa/update-configuration`)
- **Promote Branches**: Optional branches created to promote changes from one environment to another (e.g., Dev to QA, QA to Stage).
  - Naming Convention: `promote/env-to-env` (e.g., `promote/dev-to-qa`, `promote/qa-to-stage`)
- **Hotfix Branches**: Branches created from the `main` branch to address critical issues in production.
  - Naming Convention: `hotfix/issue-description` (e.g., `hotfix/fix-production-bug`)

## Workflow

1. **Creating Change Branches**: Members create change branches from the respective environment branches.
2. **Implementing Changes**: Changes are implemented and tested in `dev` environment using Terraform CLI.
3. **Pull Requests**: Once changes are tested, a pull request is created for the respective environment.
4. **Code Review**: Peers review the changes and approve the pull request.
5. **Merging Changes**: After approval, the change branch is merged into the respective environment branch.
6. **Deployment**: Approve the Terraform plan for respective environment in Jenkins.
7. **Deleting Change Branches**: After merging, the change branches are deleted to keep the repository clean.

## Promotion Workflow

1. **Creating Promote Branches**: After changes are merged into an environment branch (e.g., `dev`), a promote branch is created from that environment branch to the next environment branch (e.g., Create branch `promote/dev-to-qa` from `dev` branch).
2. **Update Changes**: Update the promote branch with the changes made in the previous environment

   - Manually make the changes in the promote branch respective directory. (E.g., update `/on-prem/env-qa` directory in `promote/dev-to-qa` branch with the changes made in `/on-prem/env-dev` directory).
   - Fine tune any environment-specific configurations if necessary.

3. **Pull Requests for Promotion**: Create a pull request from the promote branch to the target environment branch (e.g., from `promote/dev-to-qa` to `qa`).
4. **Code Review and Merging**: Follow the same code review and merging process as described above.
5. **Deployment**: Approve the Terraform plan for the target environment in Jenkins.
6. **Deleting Promote Branches**: After merging, the promote branches are deleted to keep the repository clean.

### Promoting Workflows

- **Project Specific Changes**: `dev` -> `qa` -> `stage` -> `main (green)` -> `main (blue)`
- **Cluster Management Changes**: `on-prem-management` -> `cloud-management`

### Special Scenarios

- **Hotfixes**: In case of critical issues in production, hotfix branches (e.g., `hotfix/issue-description`) can be created from the `main` branch, changes are made, and then merged back into `main` and other relevant branches. Delete the hotfix branch after merging.
- **Config Changes**: Configuration changes to an environment can be made using a change branch directly from the respective environment branch without going through the full promotion workflow, if deemed safe and necessary.
- `cluster-templates` and `jenkins-jobs` directories changes will also follow the same promotion workflow as **Project Specific Changes**.
